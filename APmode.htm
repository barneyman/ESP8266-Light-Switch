<HTML>
<HEAD>
<META NAME="GENERATOR" Content="Microsoft Visual Studio">
<TITLE></TITLE>
    <style>body {font: Arial; font-size: 20px;} .big{height:20px;width:100px;}</style>
</HEAD>
<BODY onload="OnLoad()">

    <h1 id="name">
        
    </h1>

    Bounce <input name="bounce" size="15" type="number" id="bouncems"/>
    Reset <input name="reset" size="15" type="number" id="resetms"/>
    <hr />
    ssid <input name="ssid" size="15" type="text" id="ssid"/>
    password <input name="pwd" size="15" type="password" id="pwd"/>
    <input type="button" value="Join WiFi" onclick="JoinWifi()" />

    <script>

        let base = "http://192.168.42.17"

        function OnLoad()
        {
            let url = base+'/json/config'

            fetch(url)
                .then(function(response) { return response.json(); })
                .then(function(data) {
                    for(var eachNode in data)
                    {

                        if (data.hasOwnProperty(eachNode)) {
                            // depends on the type
                            if (document.getElementById(eachNode).nodeName == 'INPUT') {
                                document.getElementById(eachNode).value = data[eachNode];
                            }
                            else {
                                document.getElementById(eachNode).innerText = data[eachNode];
                            }
                        }
                    }
                })
        }

        function JoinWifi() {

            // check there are proper values
            var jsonData = {};

            // get all inputs
            var inputs = document.getElementsByTagName('input')
            var inputValid = true;
            for (index = 0; index < inputs.length; ++index) {

                console.log(inputs[index].id)
                console.log(inputs[index].value)
                console.log('!')

                if (inputs[index].id != '') {

                    if (inputs[index].value == '')
                        inputValid = false;

                    jsonData[inputs[index].id] = inputs[index].value;
                }
            }
            if(inputValid==true) {
                console.log(jsonData)

                let url = base + '/json/config'

                var xhr = new XMLHttpRequest();
                
                xhr.open("POST", url, true);
                xhr.setRequestHeader("Content-type", "text/plain");

                xhr.send(JSON.stringify(jsonData));
                xhr.onloadend = function () {
                    // done
                    // we should delay for a couple of seconds, then try to 
                    // go to the .local domain again

                };


            }
            else
                alert('values cannot be empty')
        }


    </script>


</BODY>
</HTML>
