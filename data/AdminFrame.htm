<HTML>
<HEAD>
<META NAME="GENERATOR" Content="Microsoft Visual Studio">
<TITLE></TITLE>
    <link rel="stylesheet" type="text/css" href="switch.css">
</HEAD>
<BODY>

    <table>
        <tr>
            <th>Host</th>
            <td><input type="text" id="host"/></td>
        </tr>
        <tr>
            <th>Port</th>
            <td><input type="text" id="port" /></td>
        </tr>
        <tr>
            <th>Url</th>
            <td><input type="text" id="url" /></td>
        </tr>
    </table>
    <button onclick="OTAupdate()">Update OTA</button>

    <hr />

    <button onclick="ResetWIFI()">vanilla reset</button>

    <script src="common.js"></script>

    <script>

        function ResetWIFI() {

            let url = base + '/resetWIFI'

            var xhr = new XMLHttpRequest();

            xhr.open("GET", url, true);
            xhr.setRequestHeader("Content-type", "text/plain");

            xhr.send();

        }

        function OTAupdate() {


            var jsonData = {};

            // get all inputs
            var inputs = document.getElementsByTagName('input')
            var inputValid = true;
            for (index = 0; index < inputs.length; ++index) {


                if (inputs[index].id != '') {

                    if (inputs[index].value == '')
                        inputValid = false;

                    jsonData[inputs[index].id] = inputs[index].value;
                }
            }
            if (inputValid == true) {

                let url = base + '/json/upgrade'

                var xhr = new XMLHttpRequest();

                xhr.open("POST", url, true);
                xhr.setRequestHeader("Content-type", "text/plain");


                // then wait on a response
                xhr.onloadend = function () {
                    // done
                    // parse it
                    var jsonResponse = JSON.parse(xhr.responseText);
                    // HTTP_UPDATE_OK
                    if (jsonResponse['result'] != 2)
                     {
                        alert(jsonResponse['Details']['espNarrative'])
                    }
                    else {
                        // reload the whole site?
                        window.location.reload(true)
                    }
                };

                xhr.send(JSON.stringify(jsonData));

            }
            else
                alert('values cannot be empty')
        }




    </script>

</BODY>
</HTML>
